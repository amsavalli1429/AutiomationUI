pipeline {
    agent any

    tools {
        maven 'Maven_3_9_0'   // or the Maven name you configured in Jenkins
        jdk 'Java_17'         // your configured JDK name in Jenkins
    }

    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/amsavalli1429/AutiomationUI.git'
            }
        }

        stage('Build and Test') {
            steps {
                bat 'mvn clean test'    // This will run your TestNG tests
            }
        }

        stage('Generate Extent Report') {
            steps {
                echo 'Extent Report should be generated in test-output folder'
            }
        }
    }

    post {
        success {
            emailext(
                to: 'amsavallira114@gmail.com',
                subject: "✅ Jenkins Build SUCCESS: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                body: """<p>Hi Amsavalli,</p>
                         <p>Build succeeded for <b>${env.JOB_NAME}</b> #${env.BUILD_NUMBER}</p>
                         <p><a href="${env.BUILD_URL}">Click here to view build details</a></p>
                         <p>Regards,<br>Jenkins</p>""",
                attachmentsPattern: 'test-output/ExtentReport_*.html'
            )
        }
        failure {
            emailext(
                to: 'amsavallira114@gmail.com',
                subject: "❌ Jenkins Build FAILED: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
                body: """<p>Hi Amsavalli,</p>
                         <p>Build failed for <b>${env.JOB_NAME}</b> #${env.BUILD_NUMBER}</p>
                         <p><a href="${env.BUILD_URL}">Click here to view logs</a></p>
                         <p>Regards,<br>Jenkins</p>""",
                attachmentsPattern: 'test-output/ExtentReport_*.html'
            )
        }
    }
}
